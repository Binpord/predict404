\chapter{Обучение классификатора}

\section{Выбор модели}

Заметим, что пространство признаков имеет очень большую размерность. К тому же многие из признаков явно взаимосвязаны с другими (действительно, доля досмотревших до 90 \% видео не может быть выше доли досмотревших до 50 \%). Если с первой из этих проблем можно справиться, например, воспользовавшись методом главных компонент \footcite{Pearson1901}, то избавиться от второй гораздо сложнее.

Так как борьба с вышеозначенными проблемами сама по себе является нетривиальной задачей, было принято решение использовать модели машинного обучения, основанные на решающих деревьях \footcite{LeoConsultant1984}. Это позволяет свести предобработку данных к минимуму. Однако решающие деревья в чистом виде редко используются из-за сложностей связанных с соблюдением баланса между сложностью модели и ее обобщающей способностью. Поэтому в качестве базовой модели был выбран случайный лес \footcite{Ho}. В качестве дополнительных моделей были выбраны чрезвычайно случайные деревья (extremely randomized trees) \footcite{Geurts2006}, также метод градиентного бустинга (gradient boosting) \footcite{Friedman2001} основанный на решающих деревьях. Первые два алгоритма были взяты из библиотеки scikit-learn \footcite{scikit-learn}, последний был взят из библиотеки CatBoost \footcite{Prokhorenkova2017}.

\section{Обучение модели}

Для подбора гиперпараметров и получения оценки точности и полноты использовался сеточный поиск с оценкой точности и полноты с использованием 5-кратной кроссвалидации. Для случайного леса и чрезвычайно случайных деревьев подбиралось количество деревьев в ансамбле. Для классификатора CatBoost кроме этого подбиралась максимальная глубина дерева.

Результаты сеточного поиска представлены на рисунках \ref{fig:toloka_randomforest}, \ref{fig:toloka_extratrees} и \ref{fig:toloka_catboost}.

\begin{figure}
    \centering
    \includegraphics{./images/toloka_randomforest_precision.pdf}
    \includegraphics{./images/toloka_randomforest_recall.pdf}
    \caption{Результаты сеточного поиска для модели RandomForestClassifier}
    \label{fig:toloka_randomforest}
\end{figure}

\begin{figure}
    \centering
    \includegraphics{./images/toloka_extratrees_precision.pdf}
    \includegraphics{./images/toloka_extratrees_recall.pdf}
    \caption{Результаты сеточного поиска для модели ExtraTreesClassifier}
    \label{fig:toloka_extratrees}
\end{figure}

\begin{figure}
    \centering
    \includegraphics{./images/toloka_catboost_precision.pdf}
    \includegraphics{./images/toloka_catboost_recall.pdf}
    \caption{Результаты сеточного поиска для модели CatBoostClassifier}
    \label{fig:toloka_catboost}
\end{figure}

Наилучшей точности удалось достигнуть с использованием классификатора из библиотеки CatBoost (свыше 80.3 \%). Полнота у данного классификатора получилась выше, чем у конкурентов (около 51.5 \%).

При дальнейшем изучении предсказаний данной модели выяснились следующие факты: выборка содержит некоторое количество неверно размеченных объектов, и плеерные события имеют большой вес в предсказании модели. Первая проблема требует другого способа разметки данных, и ее решение будет предложено далее. Для решения же второй проблемы было предложено добавить в признаки идентификатор плеера. Это позволило бы модели корректировать ожидаемый профиль событий в зависимости от конкретного плеера, который их шлет. Результаты этого эксперимента представлены на рисунке \ref{fig:toloka_catboost_with_cat}. К сожалению, точность классификатора упала до 72.6 \%, однако полнота классификации возросла почти на 17 \% и составила почти 68.2 \%.

\begin{figure}
    \centering
    \includegraphics{./images/toloka_catboost_with_cat_precision.pdf}
    \includegraphics{./images/toloka_catboost_with_cat_recall.pdf}
    \caption{Результаты сеточного поиска для модели CatBoostClassifier с идентификатором плеера, как категориальный признак}
    \label{fig:toloka_catboost_with_cat}
\end{figure}